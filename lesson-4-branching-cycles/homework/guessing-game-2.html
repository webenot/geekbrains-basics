<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Lesson 4. Homework - 3. Guessing Game with 2 players</title>
</head>
<body>
<script>
    function isExitCodeEntered(str, user, exitCode = []) {
        if (isNaN(+str)) {
            if (exitCode.indexOf(str.toLowerCase()) !== -1) {
                return {
                    exit: true,
                    user
                };
            }
            return {
                exit: false,
                answer: +str
            }
        }
        return {
            exit: false,
            answer: +str
        }
    }

    var exitCode = [
        'exit', 'end', 'stop', 'выход', 'конец', 'стоп'
    ];


    var exitMessage = 'Для завершения игры введите любую из команд: ' + exitCode.join(', ');
    alert('Начинаем игру Угадайка (Угадайте число от 0 до 100)!\n' + exitMessage);

    var user1 = prompt('Введите имя первого игрока');
    var user2 = prompt('Введите имя второго игрока');
    var userResult1 = 0;
    var userResult2 = 0;
    var currentUserExited = '';

    var answer = parseInt(Math.random() * 100);

    var userAnswer = prompt('Игрок ' + user1 + ' угадайте число\n' + exitMessage);
    var result = isExitCodeEntered(userAnswer, user1, exitCode);
    if (!result.exit) {
        userAnswer = result.answer;
        do {
            if (userAnswer !== answer) {
                userAnswer = prompt('Увы, игрок ' + user1 + ' не угадал число. Правильный ответ: ' + answer + '\n' + 'Игрок ' + user2 + ' - Ваш ход, угадайте число\n' + exitMessage);
            } else {
                userAnswer = prompt('Поздравляю, игрок ' + user1 + ' угадал число.\n' + 'Игрок ' + user2 + ' - Ваш ход, угадайте число\n' + exitMessage);
                userResult1++;

            }

            result = isExitCodeEntered(userAnswer, user1, exitCode);
            if (result.exit) {
                currentUserExited = result.user;
                break;
            } else {
                userAnswer = result.answer;
            }

            answer = parseInt(Math.random() * 100);
            if (userAnswer !== answer) {
                userAnswer = prompt('Увы, игрок ' + user2 + ' не угадал число. Правильный ответ: ' + answer + '\n' + 'Игрок ' + user1 + ' - Ваш ход, угадайте число\n' + exitMessage);
            } else {
                userAnswer = prompt('Поздравляю, игрок ' + user2 + ' угадал число.\n' + 'Игрок ' + user1 + ' - Ваш ход, угадайте число\n' + exitMessage);
                userResult2++;

            }
            result = isExitCodeEntered(userAnswer, user2, exitCode);
            if (result.exit) {
                currentUserExited = result.user;
                break;
            } else {
                userAnswer = result.answer;
            }
            answer = parseInt(Math.random() * 100);
        } while (true);
    } else {
        currentUserExited = result.user;
    }

    document.write(
        'Игрок ' + currentUserExited + ' завершил игру<br>' +
        'Счет составил ' + user1 + ' (' + userResult1 + ') - ' + user2 + ' (' + userResult2 + ')<br>'
    );
    if (userResult1 > userResult2) {
        document.write('Поздравляю игрока ' + user1 + ' с победой!');
    } else if (userResult1 < userResult2) {
        document.write('Поздравляю игрока ' + user2 + ' с победой!');
    } else {
        document.write('Поздравляю игроков! Победила дружба!');
    }

</script>
</body>
</html>